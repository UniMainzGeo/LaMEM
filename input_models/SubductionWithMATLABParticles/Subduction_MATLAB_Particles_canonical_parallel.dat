# ----------------------------------------------------------------------------------------------------------------------
# A basic parameter file for FDSTAG Canonical setup for subduction
# NOTE: use CreateMarkers_Subduction.m to generate the input geometry
# ----------------------------------------------------------------------------------------------------------------------

# Define number of elements in x, y, z-direction
# Negative number implies corresponding number of mesh segments
# Data is provided in the variables seg_x, seg_y, seg_z and includes:
#    * coordinates of the delimiters between the segments (n-1 points)
#    * number of cells                                    (n points)
#    * bias coefficients                                  (n points) 
 
nel_x						=	-3    
#nel_x						=   	60    
nel_y						= 	40    
nel_z						= 	20

seg_x = -60e3 30e3 5 50 5 1.0 1.0 1.0


# Geometry
DimensionalUnits				=	1			# Dimensionless (=0) or SI-dimensional units (=1)?
Characteristic.Length			=	1e6			# [m]		
Characteristic.Viscosity 		=	1e20		# [Pa.s]
Characteristic.Temperature		=	1000		# [K]
Characteristic.Stress      		=   1e6			# [Pa]

W						=	300e3			# Width  (x-direction)
L						=	100e3			# Length (y-direction)
H						=	200e3			# Height (z-direction)

x_left					=	-150e3			# Left side of domain
y_front					=	0			# Front side of domain
z_bot					=	0			# Bottom of box

# --- Model setup ---
msetup                        = parallel
ParticleFilename              = Particles 			# File that contains markers distribution (matlab)
LoadInitialParticlesDirectory = MatlabInputParticles                 # directory that contains markers distribution (matlab)


# Define input/output and numerics-related stuff
OutputFile					=	Subduction_test		
save_timesteps				=	1				# save every ? timesteps
time_end					=	1				# last timestep
CFL							=	1				# CFL, dt-based criterium
dt_max						=	1000	  	   	# Maximum timestep [years if dimensional]
	
# Boundary conditions
BC.Eyy						=	0.0				# BG strainrate in y-direction
BC.Exx						=	0.0				# BG Strainrate in x-direction
BC.LeftBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.RightBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.FrontBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound				=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound				=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
Temp_top	    			=   0				# Temperature @ top
Temp_bottom					=   1 				# Temperature @ bottom; side BC's are flux-free

# Grid advection method
GridAdvectionMethod			= 		0 			# 0-Fully Eulerian, 1-Fully Lagrangian, 2-ALE with remeshing @ surface layer
FactorSurfaceLayer			= 		0.3 		# How thick is the surface layer (if option 2 is selected above) ?


# Define Stokes Solver
StokesSolver 				=	3   # 1 - Powell-Hesteness iterations; 2 - Schur Complement Reduction; 3 - Fully Coupled Solver 
VelocitySolver              =   0   # 0 - User defined; 1 - Direct (MUMPS); 2 - Galerkin geometric multigrid; 3 - Fieldsplit + Algebraic Multigrid (ML)

<PetscOptionsStart>

	# KSP
	-ksp_type preonly
	-pc_type lu
	-pc_factor_mat_solver_package mumps
#	-mat_mumps_icntl_14 200

	-ph_gamma  1e3
	-ph_maxit  50
	-ph_tol    1e-8

	# Fine-tune solver options here (add command-line Petsc Options)
	-vpt_element FDSTAG			# Type of element [Q2Pm1_global; Q2Pm1_local; Q1P0]
	-use_fdstag_canonical
	-AddRandomNoiseParticles 0
	-restart 0
	-save_breakpoints 0
	
#	-snes_mf_operator	
#	-snes_monitor
#	-snes_atol 1e-12
#	-snes_rtol 1e-6
#	-snes_stol 1e-6
#	-snes_max_it 25
#	-snes_max_funcs 50000

	-objects_dump

<PetscOptionsEnd>
    
# Phase distribution
NumPartX				=	3   # Particles/Cell in x-direction
NumPartY				=	3   # Particles/Cell in y-direction
NumPartZ				=	3	# Particles/Cell in z-direction

# Properties that are defined over the whole domain:
Gravity					=  -10;									# [m/s2] - gravitational acceleration 

# Define phase transitions for particles
num_phase_transitions			=	0				# The number of phase transitions present
LowerViscosityCutoff			=	1e18
UpperViscosityCutoff			=	1e18

# Define material properties for all phases -------------------------------------------------
num_phases					=	3		# Total number of phases defined in code

	# Define properties of mantle -----------------
	<MaterialStart>
		phase_id 			=	0
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1e18	
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	0
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2800
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e10
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	0
		attribute 			= 	PLASTICITY
		type 				= 	constant
		Cohesion        	= 	20e60
		FrictionAngle		= 	30
	<MaterialEnd>
	
	
	# Define properties of slab -------------------
	<MaterialStart>
		phase_id 			=	1
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1e20
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	3000
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e10
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	1
		attribute 			= 	PLASTICITY
		type 				= 	constant
		Cohesion        	= 	20e60
		FrictionAngle		= 	30
	<MaterialEnd>
	
	
	# Define properties of air -----------------
	<MaterialStart>
		phase_id 			=	2
		attribute 			= 	VISCOSITY
		type 				= 	constant
		eta0       			= 	1e18	
	<MaterialEnd>
	<MaterialStart>
		phase_id 			= 	2
		attribute 			= 	DENSITY
		type 				= 	temperature_dependent
		rho0        		= 	2800
		alpha 				=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	ELASTICITY
		type 				= 	constant
		shear        		= 	5e10
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	ENERGY
		type 				= 	constant
		ThermalConductivity	= 	3
		HeatCapacity		=	1050
		RadioactiveHeat		=	0
		ShearHeating		=	0
	<MaterialEnd>
	<MaterialStart>
		phase_id			= 	2
		attribute 			= 	PLASTICITY
		type 				= 	constant
		Cohesion        	= 	20e60
		FrictionAngle		= 	30
	<MaterialEnd>
	
# End of defining material properties for all phases ----------------------------------------
