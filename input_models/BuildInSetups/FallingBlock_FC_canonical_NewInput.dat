# Standard falling block test

# Define number of elements in x,y & z-direction
# Negative number implies corresponding number of mesh segments
# Data is provided in the variables seg_x, seg_y, seg_z and includes:
#    * coordinates of the delimiters between the segments (n-1 points)
#    * number of cells                                    (n points)
#    * bias coefficients                                  (n points) 

nel_x						=   	32    
nel_y						= 	32    
nel_z						= 	32

#nel_x						=	-3    
#seg_x = 0.7 0.8 10 4 2 0.3 1.0 3.0

# Geometry
units = none
DimensionalUnits				=	0			# Dimensionless (=0) or SI-dimensional units (=1)?
L						=	1			# Length (y-direction)
W						=	1			# Width  (x-direction)
H						=	1			# Height (z-direction)
x_left						=	0			# Left side of domain
y_front						=	0			# Front side of domain
z_bot						=	0			# Bottom of box

# Phase distribution
NumPartX				=	2   # Particles/Cell in x-direction
NumPartY				=	2   # Particles/Cell in y-direction
NumPartZ				=	2	# Particles/Cell in z-direction

# Properties that are defined over the whole domain:
Gravity					=	-1;									# [m/s2] - gravitational acceleration 

# --- Model setup and noise ---

msetup = block

#msetup                        = redundant
#ParticleFilename              = 100x100x100_10percent_channel # File that contains markers distribution (matlab)
#LoadInitialParticlesDirectory = darcy_markers                 # directory that contains markers distribution (matlab)

# Define input/output and numerics-related stuff
OutputFile					=	FB_test_new		
save_timesteps					=	1				# save every ? timesteps
time_end					=	1				# last timestep
CFL						=	0.25			# CFL, dt-based criterium
dt_max						=	1e3 	  	   	# Maximum timestep [years if dimensional]
	
# Boundary conditions
BC.Eyy						=	0.0				# BG strainrate in y-direction
BC.Exx						=	0.0				# BG Strainrate in x-direction
BC.LeftBound					=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.RightBound					=	1				# 0 - free surface, 1-free slip with BG strainrate Eyy, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.FrontBound					=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.BackBound					=	1				# 0 - free surface, 1-free slip with BG strainrate Exx, 2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.LowerBound					=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
BC.UpperBound					=	1				# 0 - free surface, 1-free slip, 				  2 - no slip, 5 - growthrate 2D, 7 - growthrate 3D
Temp_top	    				=   	0				# Temperature @ top
Temp_bottom					=   	1 				# Temperature @ bottom; side BC's are flux-free


<PetscOptionsStart>

# SNES

	-snes_npicard 3
	-snes_monitor
	-snes_atol 1e-12
	-snes_rtol 1e-6
	-snes_stol 1e-6
	-snes_max_it 25
	-snes_max_funcs 50000
	-snes_type ksponly

# Jacobian solver

	-js_ksp_type fgmres
	-js_ksp_max_it 1000
	-js_ksp_converged_reason
 	-js_ksp_monitor
	-js_ksp_rtol 1e-6

# Preconditioner

	-pcmat_type block
	-pcmat_pgamma 1e3
	-jp_type bf
	-bf_vs_type user
	-vs_ksp_type preonly
	-vs_pc_type lu
	-vs_pc_factor_mat_solver_package mumps


# Additional command-line Petsc Options
	-use_fdstag_canonical
	-AddRandomNoiseParticles 0
	-restart 0
	-save_breakpoints 0
#	-SavePartitioning

	-out_pvd 1
	-out_phase 1  
	-out_density 1
	-out_viscosity 1
	-out_velocity 1
	-out_pressure 1
	-out_temperature 1 
	-out_dev_stress 1
	-out_j2_dev_stress 1
	-out_strain_rate 1
	-out_j2_strain_rate 1

	-objects_dump

<PetscOptionsEnd>
    

# Optimization
LowerViscosityCutoff			=	1e-3
UpperViscosityCutoff			=	1e12

# Ask for new input
new_input				=	1

# Define softening laws ---------------------------------------------------------------------

  	# --------------------------
	# SOFT LAW [0]
  	# --------------------------
	<SofteningStart>
		softID 			=	0	# softening law id  [-]
		A        		= 	0.5	# softening ratio
		APS1        		= 	1	# start softening
		APS2        		=	3	# end softening
	<SofteningEnd>

  	# --------------------------
	# SOFT LAW [1]
  	# --------------------------
	<SofteningStart>
		softID 			=	1	# softening law id  [-]
		A        		= 	0.25	# softening ratio
		APS1        		= 	0.5	# start softening
		APS2        		=	5	# end softening
	<SofteningEnd>

# Define material properties for all phases -------------------------------------------------

  	# --------------------------
	# MATRIX [0]
  	# --------------------------
	<MaterialStart>
		ID 			=	0	# phase id  [-]
		rho0        		= 	1	# density - if dimensional [kg/m3]

		# diffusion creep
		eta			= 	1	# ref.  viscosity - if dimensional [Pa.s]
		#Bd       		= 	1	# diff. creep coeff - if dimensional [1/(Pa.s)]
		#Ed       		= 	1	# activation energy - if dimensional [J/mol]
		#Vd       		= 	1	# activation volume - if dimensional [cm3/mol]

		# dislocation creep
		#eta0			= 	1	# ref.  viscosity - if dimensional [Pa.s]
		#e0 			=	0.1	# ref.  strain rate - if dimensional [1/s]	
		#n       		= 	3	# power-law exponent [-]
		#Bn       		= 	1	# disl. creep coeff
		#En       		= 	1	# activation energy - if dimensional [J/mol]
		#Vn       		= 	1	# activation volume - if dimensional [cm3/mol]

		## Peierls creep
		#Bp       		= 	1	# Peierls creep coeff - if dimensional [1/(Pa.s)]
		#Ep       		= 	1	# activation energy - if dimensional [J/mol]
		#Vp       		= 	1	# activation volume - if dimensional [cm3/mol]
		#taup       		= 	1	# scaling stress - if dimensional [Pa]
		#gamma       		= 	0.1	# approximation parameter [-]
		#q       		= 	2	# stress dependent parameters [-]

		## elasticity
		#shear        		= 	5e10	# elastic shear modulus - if dimensional [Pa]
		#bulk        		= 	5e10	# elastic bulk modulus - if dimensional [Pa]
		#Kp       		= 	1	# pressure-dependent parameters [-]

		## plasticity
		#cohesion        	= 	20e60	# cohesion - if dimensional [Pa]
		#friction		= 	30	# friction angle - if dimensional [deg]

		## plasticity - strain weakening
		#chSoftID               = 	1	# softening law id - for cohesion
		#frSoftID               = 	0	# softening law id - for friction angle

		## temp
		#alpha 			=	0	# coeff.  of thermal expansion - if dimensional [1/K]
		#k			= 	3	# thermal conductivity - if dimensional [W/m/K]
		#cp			=	1050	# heat capacity - if dimensional [J/kg/K]
		#A			=	0	# radiogenic heat production - if dimensional [W/m3]
	<MaterialEnd>

  	# --------------------------
	# BLOCK [1]
  	# --------------------------
	<MaterialStart>
		ID 			=	1	# phase id  [-]
		rho0        		= 	2	# density - if dimensional [kg/m3]

		# diffusion creep
		eta			= 	1e3	# ref.  viscosity - if dimensional [Pa.s]
		#Bd       		= 	1	# diff. creep coeff - if dimensional [1/(Pa.s)]
		#Ed       		= 	1	# activation energy - if dimensional [J/mol]
		#Vd       		= 	1	# activation volume - if dimensional [cm3/mol]

		## dislocation creep
		#eta0			= 	1e3	# ref.  viscosity - if dimensional [Pa.s]
		#e0 			=	0.1	# ref.  strain rate - if dimensional [1/s]	
		#n       		= 	3	# power-law exponent [-]
		#Bn       		= 	1	# disl. creep coeff
		#En       		= 	1	# activation energy - if dimensional [J/mol]
		#Vn       		= 	1	# activation volume - if dimensional [cm3/mol]

		## Peierls creep
		#Bp       		= 	1	# Peierls creep coeff - if dimensional [1/(Pa.s)]
		#Ep       		= 	1	# activation energy - if dimensional [J/mol]
		#Vp       		= 	1	# activation volume - if dimensional [cm3/mol]
		#taup       		= 	1	# scaling stress - if dimensional [Pa]
		#gamma       		= 	0.1	# approximation parameter [-]
		#q       		= 	2	# stress dependent parameters [-]

		## elasticity
		#shear        		= 	5e10	# elastic shear modulus - if dimensional [Pa]
		#bulk        		= 	5e10	# elastic bulk modulus - if dimensional [Pa]
		#Kp       		= 	1	# pressure-dependent parameters [-]

		## plasticity
		#cohesion        	= 	20e60	# cohesion - if dimensional [Pa]
		#friction		= 	30	# friction angle - if dimensional [deg]

		## plasticity - strain weakening
		#chSoftID               = 	0	# softening law id - for cohesion
		#frSoftID               = 	1	# softening law id - for friction angle

		## temp
		#alpha 			=	0	# coeff.  of thermal expansion - if dimensional [1/K]
		#k			= 	3	# thermal conductivity - if dimensional [W/m/K]
		#cp			=	1050	# heat capacity - if dimensional [J/kg/K]
		#A			=	0	# radiogenic heat production - if dimensional [W/m3]
	<MaterialEnd>
	
# End of defining material properties for all phases ----------------------------------------