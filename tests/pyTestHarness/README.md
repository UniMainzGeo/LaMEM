# pyTestHarness: The idea #

Testing code should be easy. The functionality required to launch, parse and perform the verification should be light-weight and simple to migrate into existing projects. pyTestHarness supports unit-testing of sequential and MPI-parallel applications. Unit tests can be performed locally, or submitted via a batch queuing system (e.g. PBS, LSF, Slurm or LoadLeveler).

### Key concepts ###

pyTestHarness (pyTH) provides:

* An object to define a unit test. A "unit test" consists of: (i) a textual name; (ii) an executable; (iii) a text file containing the expected output; (iv) a method to compare any output generated by the test (e.g. from stdout or another output file)
* A set of tools to parse / filter and query text files for verification purposes
* An object to manage launching a serial (or MPI) unit test locally, or via a batch queuing system

### How do I use this pyTH? ###

1. pyTH depends on python3 (or python2) and numpy

2. When using python3, it is highly recommended you set the environment variable PYTHONUNBUFFERED, e.g.
```export PYTHONUNBUFFERED```

3. Make sure you modify your PYTHONPATH environment variable to include the directory ```${PWD}/lib``` (relative to this README file)

####Demonstration of basic unit-testing of serial applications using the test harness 


*	**Example 1, Example 4**  
Execute the test(s): 

```
	cd example1;
	python pth_example1.py
```
```
	cd example4;
	python pth_example4.py
```
Features: (i) comparison with data in a file;
(ii) multiple tests;
(iii) report summary and error log files 

*	**Example 2**  
Execute the test: 

```
	cd example2;
	python pth_example2.py
```  
Features:  (i) unit tests which are defined in separate directories;
(ii) tests can be optionally selected

* **Example 5**  
Execute the test: 

```
	cd example5;
	python pth_example5.py
```  
Features: (i) defining a test which does not an expected output file for the verification

  
      
####Demonstration of parallel tests using a PETSc code 

* **Example 3**  
Requires the environment variables ```PETSC_DIR``` and ```PETSC_ARCH``` to be defined. Execute the test:  

```
	cd example3;
	python pth_example3.py
```  
Features: (i) unit test defined using an MPI parallel application; 
(ii) unit test submission through a batch queuing system

####Tips for building tests

* The verification process involves parsing expected output and searching for keywords. If your output generates strings requiring escape characters, for example the string "|a.b|_2", the keyword provided to pyTH needs to be expressed as "\|a.b\|\_2". This is awkward so we recommend using the regular expression utilities which provide a method to add the backslash automatically. E.g.
```
#!python

import re
keyword = re.escape("|a.b|_2")
```